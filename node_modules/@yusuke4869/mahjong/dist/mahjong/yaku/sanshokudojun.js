"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sanshokudojun = void 0;
const convert_1 = require("../hai/convert");
const sort_1 = require("../hai/sort");
const convert_2 = require("./convert");
const sanshokudojun = (data) => {
    let existsFuro = false;
    const shuntsuArr = data.agari.elements.filter((v) => {
        if (v.furo)
            existsFuro = true;
        return v.type === "shuntsu";
    });
    const shuntsuSet = new Set(shuntsuArr);
    if (shuntsuSet.size < 3)
        return convert_2.notExistsRes;
    const haiTypeArr = shuntsuArr.map((v) => v.hai[0].slice(-1));
    const haiTypeSet = new Set(haiTypeArr);
    if (haiTypeSet.size !== 3)
        return convert_2.notExistsRes;
    const numArr = [];
    for (const elem of Array.from(shuntsuSet)) {
        const hai = (0, sort_1.sortHai)(elem.hai);
        const n1 = (0, convert_1.getHaiNormalNum)(hai[0]);
        const n2 = (0, convert_1.getHaiNormalNum)(hai[1]);
        const n3 = (0, convert_1.getHaiNormalNum)(hai[2]);
        if (n2 === n1 + 1 && n3 === n1 + 2) {
            numArr.push(n1);
        }
    }
    const numSet = new Set(numArr);
    if (numArr.length === 3 && numSet.size === 1) {
        const res = {
            exists: true,
            yaku: "三色同順",
            han: existsFuro ? 1 : 2,
            yakuman: 0,
        };
        return res;
    }
    if (numArr.length !== 4 && numSet.size > 2)
        return convert_2.notExistsRes;
    for (const num of numSet) {
        if (numArr.filter((v) => v === num).length >= 3) {
            const res = {
                exists: true,
                yaku: "三色同順",
                han: existsFuro ? 1 : 2,
                yakuman: 0,
            };
            return res;
        }
    }
    return convert_2.notExistsRes;
};
exports.sanshokudojun = sanshokudojun;
//# sourceMappingURL=sanshokudojun.js.map